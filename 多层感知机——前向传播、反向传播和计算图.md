## å‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾



è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è®²è§£è§†é¢‘ï¼Œ[å¦‚ä½•ç†è§£â€œæ¢¯åº¦ä¸‹é™æ³•â€ï¼Ÿä»€ä¹ˆæ˜¯â€œåå‘ä¼ æ’­â€ï¼Ÿé€šè¿‡ä¸€ä¸ªè§†é¢‘ï¼Œä¸€æ­¥ä¸€æ­¥å…¨éƒ¨ææ˜ç™½]( https://www.bilibili.com/video/BV1Zg411T71b/?share_source=copy_web&vd_source=b9fad40156ac06edc803202851dbf50c),è¿™é‡Œæˆ‘æŠŠæˆ‘çš„è§‚åæ„Ÿå’Œç†è§£è¿›è¡Œæ€»ç»“è¡¨è¿°ã€‚

### å‰å‘ä¼ æ’­ï¼ˆè®¡ç®—æ¯ä¸ªç¥ç»å…ƒçš„è¾“å‡ºå€¼ï¼‰

> *å‰å‘ä¼ æ’­*ï¼ˆforward propagationæˆ–forward passï¼‰ æŒ‡çš„æ˜¯ï¼šæŒ‰é¡ºåºï¼ˆä»è¾“å…¥å±‚åˆ°è¾“å‡ºå±‚ï¼‰è®¡ç®—å’Œå­˜å‚¨ç¥ç»ç½‘ç»œä¸­æ¯å±‚çš„ç»“æœã€‚

é¦–å…ˆæˆ‘ä»¬æ˜ç¡®ï¼Œå‰å‘ä¼ æ’­å¯ä»¥è¿›è¡Œæ¢¯åº¦è®¡ç®—ï¼Œä½†æ˜¯ç”±äºä»–çš„ç¼ºç‚¹ï¼ˆæ¯”è¾ƒè€—å†…å­˜ï¼Œå®¹æ˜“å‡ºé”™ï¼‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨åå‘ä¼ æ’­è®¡ç®—è¯¯å·®ï¼Œåªä½¿ç”¨å‰å‘ä¼ æ’­æŠŠæ•°å€¼ç»™è¿›è¡Œè®¡ç®—ã€‚

æˆ‘ä»¬ä»¥å…¨è¿æ¥ä¸ºä¾‹ï¼š![1684820335796](C:\Users\è£´è‹±è±ª\Desktop\æ€ç»´å¯¼å›¾æ€»ç»“\ç¬¬äºŒä¸ªæœˆ\æ·±åº¦å­¦ä¹ ç¬”è®°\source\mlp6.png)

ä»–æœ‰å¤šä¸ªéšè—å±‚ï¼Œä¸”æ¯ä¸ªéšè—å±‚æœ‰ä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¾¹çš„è¿™ä¸ªå…¬å¼æ¥è¡¨è¾¾ä¸€ä¸ªéšè—å±‚çš„è¾“å…¥è¾“å‡ºï¼Œæˆ‘ä»¬å…ˆæ¥å¯¹æ¯ä¸ªç¬¦å·è¿›è¡Œä¸€ä¸‹è§£é‡Šï¼š$f_l( Â·)$è¡¨ç¤ºç¬¬lå±‚çš„æ¿€æ´»å‡½æ•°ï¼Œ$W^{(l)}$è¡¨ç¤ºç¬¬l-1å±‚åˆ°ç¬¬lå±‚çš„æƒé‡çŸ©é˜µï¼Œ$b^{(l)}$è¡¨ç¤ºç¬¬l-1å±‚åˆ°ç¬¬lå±‚çš„åç½®ï¼Œ$z^{(l)}$è¡¨ç¤ºç¬¬lå±‚ç¥ç»å…ƒçš„å‡€è¾“å…¥ï¼ˆå‡€æ´»æ€§è´¨ï¼‰ï¼Œ$a^{(l)}$è¡¨ç¤ºç¬¬lå±‚ç¥ç»å…ƒï¼ˆç¬¬ä¸€å±‚çš„è¾“å…¥æ˜¯$x=a^{(0)}$ï¼‰çš„è¾“å‡ºï¼ˆæ´»æ€§å€¼ï¼‰ã€‚

é¦–å…ˆæˆ‘ä»¬å…³æ³¨ç¬¬lå±‚çš„ç¥ç»å…ƒè·å¾—çš„è¾“å…¥ï¼Œæ¥è‡ªç¬¬l-1å±‚çš„$a^{l-1}$,åˆ™æˆ‘ä»¬å¯ä»¥è·å¾—çš„å‡€æ´»æ€§å€¼ä¸º$z^{(l)}=W^{(l)} a^{(l-1)} + b^{(l)}$,ç„¶åé€å…¥æ¿€æ´»å‡½æ•°å¾—åˆ°ç¬¬lå±‚ç¥ç»å…ƒçš„æ´»æ€§å€¼:$a^{(l)}=f_l(z^{(l)})$ã€‚

ä¸Šè¿°å†…å®¹å¯ä»¥ç®€å†™ä¸ºï¼š
$$
\boldsymbol{z}^{(l)}=\boldsymbol{W}^{(l)} \cdot f_{l-1}\left(\boldsymbol{z}^{(l-1)}\right)+\boldsymbol{b}^{(l)}\\æˆ–è€…\\
\boldsymbol{a}^{(l)}=f_l\left(\boldsymbol{W}^{(l)} \cdot \boldsymbol{a}^{(l-1)}+\boldsymbol{b}^{(l)}\right)
$$
å¦‚æœæˆ‘ä»¬åªå…³æ³¨æ•°æ®çš„æµå‘ï¼Œç»“æœå°±æ˜¯:
$$
\left.\boldsymbol{x}=\boldsymbol{a}^{(0)} \rightarrow \boldsymbol{z}^{(1)} \rightarrow \boldsymbol{a}^{(1)} \rightarrow \boldsymbol{z}^{(2)} \rightarrow \cdots \rightarrow \boldsymbol{a}^{(L-1)} \rightarrow \boldsymbol{z}^{(L)} \rightarrow \boldsymbol{a}^{(L)}=\phi(\boldsymbol{x} ; \boldsymbol{W}, \boldsymbol{b})\right)
$$


**å‰å‘ä¼ æ’­è®¡ç®—å›¾**å¯ä»¥è¿›ä¸€æ­¥å¸®åŠ©æˆ‘ä»¬ç†è§£æ“ä½œç¬¦å’Œå˜é‡çš„ä¾èµ–å…³ç³»ï¼Œå¦‚:

![../_images/forward.svg](C:\Users\è£´è‹±è±ª\Desktop\æ€ç»´å¯¼å›¾æ€»ç»“\ç¬¬äºŒä¸ªæœˆ\æ·±åº¦å­¦ä¹ ç¬”è®°\source\forward.svg)

è€Œå¦‚æœæˆ‘ä»¬å°±æ­¤è¿›è¡ŒæŸå¤±è®¡ç®—ï¼Œé‚£ä¹ˆå•ä¸ªæ ·æœ¬çš„æŸå¤±é¡¹ä¸º:$L = l(\mathbf{o}, y).$,ç»™å®š$L_2$æ­£åˆ™åŒ–çš„ç³»æ•°$\lambda$,æ­£åˆ™åŒ–é¡¹ä¸º:$s = \frac{\lambda}{2} \left(\|\mathbf{W}^{(1)}\|_F^2 + \|\mathbf{W}^{(2)}\|_F^2\right)$.æœ€åå°±å¯ä»¥ç®—å‡ºåœ¨ç»™å®šæ ·æœ¬ä¸Šçš„æ­£åˆ™åŒ–æŸå¤±ä¸º:
$$
J = L + s.
$$
Jå°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°ï¼ˆobjective functionï¼‰



### åå‘ä¼ æ’­

æˆ‘ä»¬æœ€åçš„ç›®çš„æ˜¯è·å¾—è®¡ç®—ç¥ç»ç½‘ç»œå‚æ•°çš„æ¢¯åº¦ã€‚ç®€è€Œè¨€ä¹‹ï¼Œåå‘ä¼ æ’­å°±æ˜¯åˆ©ç”¨å¾®ç§¯åˆ†ä¸­çš„é“¾å¼æ³•åˆ™ï¼Œä»**è¾“å‡ºå±‚åˆ°è¾“å…¥å±‚**éå†ç½‘ç»œã€‚å¹¶ä½¿ç”¨è®¡ç®—å›¾å­˜å‚¨äº†è®¡ç®—æŸäº›å‚æ•°éœ€è¦çš„ä»»ä½•ä¸­é—´å˜é‡ï¼ˆåå¯¼æ•°ï¼‰ã€‚å¦‚$\mathsf{Y}=f(\mathsf{X})$å’Œ$\mathsf{Z}=g(\mathsf{Y})$,å…¶ä¸­è¾“å…¥å’Œè¾“å‡ºXYZæ˜¯ä»»æ„å½¢çŠ¶çš„å¼ é‡ï¼Œåˆ™Zå…³äºXçš„å¯¼æ•°æ˜¯:$\frac{\partial \mathsf{Z}}{\partial \mathsf{X}} = \text{prod}\left(\frac{\partial \mathsf{Z}}{\partial \mathsf{Y}}, \frac{\partial \mathsf{Y}}{\partial \mathsf{X}}\right).$

prodä»£è¡¨äº†ç›¸ä¹˜ï¼ˆçŸ©é˜µæ±‚å¯¼ä¸­çš„é“¾å¼æ³•åˆ™è¦æ±‚ä»å³å¾€å·¦ä¹˜ï¼‰ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å…·ä½“åˆ†æï¼Œæˆ‘ä»¬è¦æ±‚æŸå¤±å‡½æ•°å¯¹æŸç¬¬lå±‚çš„ç¬¬iè¡Œjåˆ—çš„å‚æ•°$w_{ij}^{(l)}$è¿›è¡Œæ±‚å¯¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é“¾å¼æ³•åˆ™:
$$
\frac{\delta L(y,\hat y)}{\delta w_{ij}^{(l)}}=\frac{\delta z^{(l)}}{\delta w_{ij}^{(l)}}\frac{\delta L(y,\hat y)}{\delta z^{(l)}}\\
\frac{\delta L(y,\hat y)}{\delta b^{(l)}}=\frac{\delta z^{(l)}}{\delta b^{(l)}}\frac{\delta L(y,\hat y)}{\delta z^{(l)}}\\
$$
ä»ä¸Šå¼å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬çš„æ¢¯åº¦ä¸»è¦ç”±ä¸‰ä¸ªåŸºç¡€çš„åå¯¼æ•°$\frac{\delta z^{(l)}}{\delta w_{ij}^{(l)}},\frac{\delta z^{(l)}}{\delta b^{(l)}}$ï¼Œå’Œä¸€ä¸ªæœ€å…³é”®çš„$,\frac{\delta L(y,\hat y)}{\delta z^{(l)}},\\$æ„æˆï¼Œå‰ä¸¤ä¸ªéƒ½æ˜¯å•ç‹¬çš„ä¸€å±‚ä¹‹é—´çš„åå¯¼æ•°ï¼Œåè¾¹çš„åå¯¼æ•°ç›´æ¥ä¸æŸå¤±å‡½æ•°ç›¸å…³ã€‚

æˆ‘ä»¬å…ˆæ¥è®¡ç®—åå¯¼æ•°$\frac{\delta z^{(l)}}{\delta w_{ij}^{(l)}}$,å› ä¸º$z^{(l)}=W^{(l)} a^{(l-1)} + b^{(l)}$,è€Œ$w_{ij}$æ˜¯ä¸€ä¸ªæ ‡é‡ä¸”åªä¸å¯¹åº”ä½ç½®çš„$a_{ij}$ä½œä¹˜æ³•ï¼Œæ‰€ä»¥æœ‰ï¼šæœ€åçš„ç»“æœæ˜¾ç¤ºäº†è¿™ä¸€ä¸ªåå¯¼æ•°çš„å¤§å°åªä¸ä»–çš„è¾“å…¥æœ‰å…³ï¼Œè€Œå’Œå…¶å®ƒæ— å…³ã€‚

![1684830772797](C:\Users\è£´è‹±è±ª\Desktop\æ€ç»´å¯¼å›¾æ€»ç»“\ç¬¬äºŒä¸ªæœˆ\æ·±åº¦å­¦ä¹ ç¬”è®°\source\z-ij.png)

ç„¶åæˆ‘ä»¬è®¡ç®—åå¯¼æ•°$\frac{\delta z^{(l)}}{\delta b^{(l)}}$ï¼Œä»æˆ‘ä»¬çš„å¼å­é‡Œ$z^{(l)}=W^{(l)} a^{(l-1)} + b^{(l)}$å¯ä»¥çœ‹å‡ºï¼Œzå’Œbéƒ½æ˜¯ç›¸åŒç»´åº¦çš„å‘é‡ï¼Œä¸”zæ˜¯å•çº¯çš„bçš„å’Œï¼Œé‚£ä¹ˆ$\frac{\delta z^{(l)}}{\delta b^{(l)}}$çš„ç»“æœå°±æ˜¯ä¸€ä¸ªå•ä½çŸ©é˜µã€‚

æœ€åæ˜¯æœ€é‡è¦çš„ä¸€éƒ¨åˆ†$\frac{\delta L(y,\hat y)}{\delta z^{(l)}}$ï¼Œå®ƒè¡¨ç¤ºç¬¬lå±‚ç¥ç»å…ƒå¯¹æœ€ç»ˆæŸå¤±çš„å½±å“ï¼Œä¹Ÿåæ˜ äº†**æœ€ç»ˆæŸå¤±å¯¹ç¬¬lå±‚ç¥ç»å…ƒçš„æ•æ„Ÿç¨‹åº¦**ï¼Œå› æ­¤ä¸€èˆ¬ç§°ä¸ºç¬¬lå±‚ç¥ç»å…ƒçš„è¯¯å·®é¡¹ç”¨$\delta^{(l)}$æ¥è¡¨ç¤ºï¼š
$$
\delta^{(l)}=\frac{\delta L(y,\hat y)}{\delta z^{(l)}} \in â„^{ğ‘€_ğ‘™}
$$
æ ¹æ® $\boldsymbol{z}^{(l+1)}=\boldsymbol{W}^{(l+1)} \boldsymbol{a}^{(l)}+\boldsymbol{b}^{(l+1)}$, æœ‰
$$
\frac{\partial \boldsymbol{z}^{(l+1)}}{\partial \boldsymbol{a}^{(l)}}=\left(\boldsymbol{W}^{(l+1)}\right)^{\top} \quad \in \mathbb{R}^{M_l \times M_{l+1}} .
$$
æ ¹æ® $\boldsymbol{a}^{(l)}=f_l\left(\boldsymbol{z}^{(l)}\right)$, å…¶ä¸­ $f_l(\cdot)$ ä¸ºæŒ‰ä½è®¡ç®—çš„å‡½æ•°, å› æ­¤æœ‰
$$
\begin{aligned}
\frac{\partial \boldsymbol{a}^{(l)}}{\partial \boldsymbol{z}^{(l)}} & =\frac{\partial f_l\left(\boldsymbol{z}^{(l)}\right)}{\partial \boldsymbol{z}^{(l)}} \\
& =\operatorname{diag}\left(f_l^{\prime}\left(\boldsymbol{z}^{(l)}\right)\right) \quad \in \mathbb{R}^{M_l \times M_l} .
\end{aligned}
$$
å› æ­¤, æ ¹æ®é“¾å¼æ³•åˆ™, ç¬¬ $l$ å±‚çš„è¯¯å·®é¡¹ä¸º
$$
\delta^{(l)} \triangleq \frac{\partial \mathcal{L}(\boldsymbol{y}, \hat{\boldsymbol{y}})}{\partial \boldsymbol{z}^{(l)}}
$$
$$
\begin{aligned}
& =\frac{\partial \boldsymbol{a}^{(l)}}{\partial \boldsymbol{z}^{(l)}} \cdot \frac{\partial \boldsymbol{z}^{(l+1)}}{\partial \boldsymbol{a}^{(l)}} \cdot \frac{\partial \mathcal{L}(\boldsymbol{y}, \hat{\boldsymbol{y}})}{\partial \boldsymbol{z}^{(l+1)}} \\
& =\operatorname{diag}\left(f_l^{\prime}\left(\boldsymbol{z}^{(l)}\right)\right) \cdot\left(\boldsymbol{W}^{(l+1)}\right)^{\top} \cdot \delta^{(l+1)} \\
& =f_l^{\prime}\left(\boldsymbol{z}^{(l)}\right) \odot\left(\left(\boldsymbol{W}^{(l+1)}\right)^{\top} \delta^{(l+1)}\right) \in \mathbb{R}^{M_l},
\end{aligned}
$$

ä½ æœ€åå¯ä»¥å‘ç°ç¬¬lå±‚çš„è¯¯å·®é¡¹å˜æˆäº†ç¬¬l+1å±‚çš„è¯¯å·®é¡¹å’Œl+1å±‚çš„å‚æ•°çŸ©é˜µä»¥åŠæ¿€æ´»å‡½æ•°å¯¹ç¬¬lå±‚çš„å‡€æ¿€æ´»å€¼çš„åå¯¼çš„ä¹˜ç§¯ï¼Œå°±å¯ä»¥è½»æ˜“åœ°é€šè¿‡å‰å‘ä¼ æ’­çš„è®¡ç®—ç»“æœå’Œåå‘ä¼ æ’­çš„è¯¯å·®ï¼Œç®—å‡ºæ¯ä¸€å±‚çš„è¯¯å·®é¡¹ã€‚

è·å¾—äº†è¯¯å·®é¡¹ï¼Œæˆ‘ä»¬çš„åç½®å°±å®¹æ˜“å¾—åˆ°äº†L(ğ’š, ğ’š)Ì‚ å…³äºç¬¬ğ‘™ å±‚æƒé‡ğ‘¾(ğ‘™) å’Œç¬¬lå±‚åç½®ç½®ğ’ƒ(ğ‘™)çš„æ¢¯åº¦ä¸ºï¼š
$$
\frac{ğœ•L(y,\hat y)}{ğœ•W^{(ğ‘™)}} = ğ›¿^{(ğ‘™)}(ğ’‚(ğ‘™âˆ’1))\\
\frac{ğœ•L(y,\hat y)Ì‚}{ğœ•b^{(ğ‘™)}} = ğ›¿^{(ğ‘™)}
$$

#### æ€»ç»“

åœ¨è®¡ç®—æ¯ä¸€å±‚çš„è¯¯å·®é¡¹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æ¯ä¸€å±‚å‚æ•°çš„æ¢¯åº¦ï¼Œæ‰€ä»¥ä»ç†è®ºçš„è§’åº¦æ¥è¯´ï¼Œä½¿ç”¨è¯¯å·®é¡¹åå‘ä¼ æ’­çš„å‰é¦ˆç¥ç»ç½‘ç»œè®­ç»ƒè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥ï¼š

 å‰é¦ˆè®¡ç®—æ¯ä¸€å±‚çš„å‡€è¾“å…¥ğ’›(ğ‘™) å’Œæ¿€æ´»å€¼ğ’‚(ğ‘™)ï¼Œç›´åˆ°æœ€åä¸€å±‚ï¼›

 åå‘ä¼ æ’­è®¡ç®—æ¯ä¸€å±‚çš„è¯¯å·®é¡¹ğ›¿(ğ‘™)ï¼›

 è®¡ç®—æ¯ä¸€å±‚å‚æ•°çš„åå¯¼æ•°ï¼Œå¹¶æ›´æ–°å‚æ•°